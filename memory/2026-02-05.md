# 2026-02-05 - Daily Notes

## Activity Stream Fix (06:47 AM)

**Issue:** Activity stream not posting to Discord - HTTP 404 errors.

**Root cause:** `parser.js` was posting to `/webhook` but Discord bot listens on `/webhook/activity`.

**Fix:** Updated `parser.js` line 16:
```javascript
// Before:
const WEBHOOK_URL = process.env.WEBHOOK_URL || 'http://localhost:3000/webhook';

// After:
const WEBHOOK_URL = process.env.WEBHOOK_URL || 'http://localhost:3000/webhook/activity';
```

**Action taken:**
1. Fixed webhook URL in parser.js
2. Restarted `claw-activity-parser` service with PM2
3. Verified no more 404 errors in parser logs

**Status:** âœ… Fixed

---

## Notes

- Parser uses `tail -F -n 0` so restarts don't replay old logs (starts fresh)
- Both services (`claw-activity-stream` and `claw-activity-parser`) running normally
- Webhook endpoint: `http://localhost:3000/webhook/activity`

---

## Activity Stream Fix (Round 2) - 07:05 AM

**Issue:** Activity stream still not posting - HTTP 401 Unauthorized errors.

**Root causes found:**
1. Parser wasn't sending `X-Webhook-Secret` header
2. Parser was wrapping payload in extra layers (`type: 'activity'`, `formatted`, etc.) but bot expects simple structure
3. Missing `WEBHOOK_SECRET` configuration in parser

**Fixes applied to `parser.js`:**

1. **Added webhook secret:**
```javascript
const WEBHOOK_SECRET = process.env.WEBHOOK_SECRET || 'claw-secret-key-change-in-production-2024';
```

2. **Added secret header:**
```javascript
headers: {
  'Content-Type': 'application/json',
  'X-Webhook-Secret': WEBHOOK_SECRET,
},
```

3. **Fixed payload structure:**
   - Removed wrapper layers
   - Mapped parser activity types to bot's expected format
   - Simple structure with `type`, `tool`, `result`/`error`, `timestamp`

**Action taken:**
1. Updated parser.js with all three fixes
2. Restarted `claw-activity-parser` service at 07:05:12
3. Manually tested webhook endpoint - working correctly (got messageId: 1468699021349486670)

**Status:** âœ… Fixed - awaiting new activity to verify end-to-end

---

## Activity Stream Enhancement - 07:28 AM

**Issue:** Bob reports stream previously captured "thinking" and "user messages" but stopped showing those after fixes. Current parser only catching gateway errors and slow listeners.

**Root cause:** New parsers (`parser-enhanced.js`, `parser-full.js`) only watched `gateway.err.log`, which doesn't contain user messages or reasoning blocks. That data lives in session files (`~/.openclaw/agents/main/sessions/*.jsonl`).

**Solution:** Created `parser-full.js` which:
1. Tails `gateway.err.log` for system events (errors, slow listeners, tools)
2. Polls session directory every 2 seconds for active session file
3. Parses JSONL lines for:
   - User messages (role: "user") â†’ `type: "info"`, message: "ðŸ‘¤ User: ..."
   - Reasoning blocks (type: "thinking") â†’ `type: "reasoning"`
   - Assistant responses (role: "assistant") â†’ `type: "info"`, message: "ðŸ¤–: ..."

**Patterns now captured:**
- âœ… User messages (what Bob sends)
- âœ… Reasoning blocks (agent thinking)
- âœ… Assistant responses
- âœ… Tool calls (success/fail)
- âœ… Errors, lane waits, slow listeners, gateway errors

**Action taken:**
1. Created `parser-full.js` with session file watching
2. Updated PM2 to use new parser
3. Verified session detection working: "Switched to session: e6118474-1fd6-4445-a8a9-4a9eacb42307.jsonl"
4. Confirmed webhook receiving: `user_message`, `assistant_response`, `reasoning` events
5. Confirmed Discord bot posting: all events showing in logs with messageId success

**Status:** âœ… Working - full activity stream restored

---

## Equity Briefing - 08:00 AM

**Task:** Run morning briefing for 17 ASX coverage stocks.

**Script:** Created `/Users/bclawd/.openclaw/workspace/equity-research/morning_briefing.py`

**Market conditions (Feb 5, 2026):**
- Broad tech sell-off across ASX
- Nasdaq -2.15% overnight (AMD, AppLovin, Palantir down)
- Bitcoin extending rout (~$71-72k)
- ASX 200 down ~1%, 2.1% below 52-week high

**Top movers:**
- ðŸŸ¢ TLS: +0.82% (only gainer - defensive)
- ðŸ”´ XRO: -15.90% (hit 52-week low, YTD -17.78%)
- ðŸ”´ WTC: -10.68%
- ðŸ”´ TNE: -10.47%
- ðŸ”´ ZIP: -9.03%
- ðŸ”´ NWS: -9.46%
- ðŸ”´ REA: -7.23% (CoStar activist campaign news)

**Coverage stocks tracked:** 17
- LIF (no data - possible delisting)
- ABB: -2.25%
- CAR: -7.36%
- IEL: -6.89%
- MP1: -4.91%
- NWS: -9.46%
- NXT: -3.09%
- REA: -7.23%
- SEK: -8.20%
- SLC: -6.22%
- TLS: +0.82%
- TNE: -10.47%
- TPG: -0.76%
- WTC: -10.68%
- XRO: -15.90%
- XYZ: -7.21%
- ZIP: -9.03%

**Output:**
- Saved to `/tmp/equity-briefing.md`
- Posted to Discord channel `bclawdaudit` (messageId: 1468713444768354467)

**Status:** âœ… Complete - daily briefing system operational
