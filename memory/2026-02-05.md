# 2026-02-05 - Daily Notes

## Activity Stream Fix (06:47 AM)

**Issue:** Activity stream not posting to Discord - HTTP 404 errors.

**Root cause:** `parser.js` was posting to `/webhook` but Discord bot listens on `/webhook/activity`.

**Fix:** Updated `parser.js` line 16:
```javascript
// Before:
const WEBHOOK_URL = process.env.WEBHOOK_URL || 'http://localhost:3000/webhook';

// After:
const WEBHOOK_URL = process.env.WEBHOOK_URL || 'http://localhost:3000/webhook/activity';
```

**Action taken:**
1. Fixed webhook URL in parser.js
2. Restarted `claw-activity-parser` service with PM2
3. Verified no more 404 errors in parser logs

**Status:** ✅ Fixed

---

## Notes

- Parser uses `tail -F -n 0` so restarts don't replay old logs (starts fresh)
- Both services (`claw-activity-stream` and `claw-activity-parser`) running normally
- Webhook endpoint: `http://localhost:3000/webhook/activity`

---

## Activity Stream Fix (Round 2) - 07:05 AM

**Issue:** Activity stream still not posting - HTTP 401 Unauthorized errors.

**Root causes found:**
1. Parser wasn't sending `X-Webhook-Secret` header
2. Parser was wrapping payload in extra layers (`type: 'activity'`, `formatted`, etc.) but bot expects simple structure
3. Missing `WEBHOOK_SECRET` configuration in parser

**Fixes applied to `parser.js`:**

1. **Added webhook secret:**
```javascript
const WEBHOOK_SECRET = process.env.WEBHOOK_SECRET || 'claw-secret-key-change-in-production-2024';
```

2. **Added secret header:**
```javascript
headers: {
  'Content-Type': 'application/json',
  'X-Webhook-Secret': WEBHOOK_SECRET,
},
```

3. **Fixed payload structure:**
   - Removed wrapper layers
   - Mapped parser activity types to bot's expected format
   - Simple structure with `type`, `tool`, `result`/`error`, `timestamp`

**Action taken:**
1. Updated parser.js with all three fixes
2. Restarted `claw-activity-parser` service at 07:05:12
3. Manually tested webhook endpoint - working correctly (got messageId: 1468699021349486670)

**Status:** ✅ Fixed - awaiting new activity to verify end-to-end
